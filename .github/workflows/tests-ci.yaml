name: Run Test Cases
run-name: ${{ github.actor }} is running test cases in GitHub Actions ðŸš€
on:
    pull_request:
        branches: [main, staging, development]
jobs:
    run-defined-python-tests:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4
              with:
                  ref: ${{ github.event.pull_request.head.sha }}

            - name: Install python3
              uses: actions/setup-python@v5
              with:
                python-version: '3.11'

            - name: Install poetry
              run: pipx install poetry

            - name: Install Packages
              run: poetry install

            - name: Run tests
              run: poetry run pytest --cov lodash_python --cov-report xml

            - name: Report results to DeepSource
              run: |
                  curl https://deepsource.io/cli | sh
                  ./bin/deepsource report --analyzer test-coverage --key python --value-file ./coverage.xml
              env:
                  DEEPSOURCE_DSN: ${{ secrets.DEEPSOURCE_DSN }}